###########################################################
#
# QuickIsoSeq pipeline for RNA-seq isoform quantification
#
###########################################################
	
!!! Note !!!
You can run QuickIoSeq off-shelf in a HPC cluster with a "LSF" job managment system. 
Otherwise, you need to tweak the following scripts and change the command lines 
with "bsub". This should be trivial. 
	* run-isoseq.sh
	* create_indexes.GRCh38_Genecode30.sh
	
!!! Impatient users !!!
If you cannot wait, run the following commands one by one. Otherwise, skip to ""Prerequisites".
	export QuickIsoSeq=<Your QuickIsoSeq Install Folder>
	export PATH=$QuickIsoSeq:$PATH
	cd $QuickIsoSeq
	./install-tools.sh  					#<10min, install third party tools
	./create_indexes.GRCh38_Genecode30.sh	# ~1hr,  create index files for GRCh38/Gencode v30
	cd test-run
	# Please modify allIDs.txt,run.config, sample.annotation.txt and "export path" in master-cmd.sh 
	# !!! Cut-and-paste the command lines in master-cmd.sh and run them 
	# !!! Wait and run Step #2 after Step #1 is 100% done.


###########################################################
#
## Prerequisites
#
###########################################################

It is assumed you has already installed
	* perl, java and R > 3.2
	* python with MultiQC package installed

For R, make sure these two libraries are installed as well.
	* ggplot2
	* reshape2


###########################################################
#
## Set up QuickIsoSeq
#
###########################################################

!!!  Important !!!
Please set environment QuickIsoSeq to your QuickIsoSeq installation folder.
And add it to your PATH
	export QuickIsoSeq=<Your QuickIsoSeq Install Folder>
	export PATH=$QuickIsoSeq:$PATH
For instance,
	export QuickIsoSeq=/lustre/workspace/projects/ECD/zhaos25/QuickIsoSeq
	export PATH=$QuickIsoSeq:$PATH

!!!
1. Install other third-party open source tools by run
	install-tools.sh 

It takes about 10 minutes. The locations of all installed tools can be found in 
	$QuickIsoSeq/tools_path.txt

!!!
2. Prepare index files for different species.  An example script 
	create_indexes.GRCh38_Genecode30.sh 
is provided, which creates all the index files corresponding to
human genome GRCh38 and Gencode Release version 30. Please twist
it for other species and Gencode versions.

The running time is ~1hr. The locations for all indexed files can be found in 
	${INDEX_ROOT}/indexes_path.txt
By default, INDEX_ROOT points to $QuickIsoSeq/Indexes/GRCh38_Genecode30	if
you prepare those indexes using create_indexes.GRCh38_Genecode30.sh
	
!!! Caution: make sure all your index files are succerssfuly created before 
moving on to run QuickIsoSeq

###########################################################
#
## Run QuickIsoSeq: 3 steps and 2 command lines
#
###########################################################

After downloading QucikIsoSeq, you will see a directory named “test_run”. 
This is an example project directory. We are using the same 48 GTEx samples 
from 5 donors as in the original QuickRNASeq publication. This test_run project 
directory contains four files for you to customize them and then run QuickIsoSeq. 
•	allIDs.txt: sample identifiers to be processed
•	sample.annotation.txt: an annotation file for RNA samples
•	run.config: The configuration file for a QuickIsoSeq run
•	master-cmd.sh: command lines for run QuickIsoSeq. This is simply for convenience

!!!
You are recommended to copy these files to any working folder and then tailor 
them to your computational environment and RNA-seq project, as described as follows. 


Step #1: Prepare sample ID list, sample annotation and run.config file
================================
!!!
1)  allIDs.txt --sample ID file, an unique ‘sample_id’  per line. 
Assume the suffix of fastq files is fq.gz, and its corresponding fastq files are: 
		sample_id_1.fq.gz
		sample_id_2.fq.gz

!!!		
2) sample.annotation.txt -- sample annotation file:
		column #1:  sample_id
		column #2:  subject_id
		column #3--#n (optional)
For clinical RNA-seq, samples from the same subject should be assigned to the same subject_id.

!!!
3) run.config  -- The configuration file to control how QuickIsoSeq to run.

Part #1 contains RNA-seq sequencing project specific information; 
	• FASTQ_DIR: the directory where the fastq files are located. 
	• FASTQ_SUFFIX: typically a fastq file ends with fastq.gz, fq.gz, fastq or fq
	• STRAND: non-stranded:0; first read forward strand:1; first read reverse strand:2
	• SEQUENCE_TYPE: “pair” for pair-ended reads; “single” for single-ended sequencing
	• SEQUENCE_DEPTH: set it to “regular” <80 million reads; otherwise set to “deep” 
	• ISOFORM_ALGORITHM: set it to RSEM, KALLISTO, SALMON_ALN, SALMON or ALL

Part #2 provides species-specific indexes, reference genome and gene annotation, 
	generated by something like create_indexes.GRCh38_Genecode30.sh above;
	please refer to 
			$INDEX_ROOT/indexes_path.txt
		
Part #3 sets the locations of tools and software specific parameters.
	For tool locations, please refer to 
			$QuickIsoSeq/tools_path.txt
		

!!!
Step #2: Run pipeline to process individual samples: mapping, counting and QC
=============================
	export QuickIsoSeq=<Your QuickIsoSeq Install Folder>
	export PATH=$QuickIsoSeq:$PATH
	run-isoseq.sh allIDs.txt run.config

Move on to next step after all jobs are completed.

!!!
Step #3: Merge results from individual samples and generate an integrated QC and web report
============================
	export QuickIsoSeq=<Your QuickIsoSeq Install Folder>
	export PATH=$QuickIsoSeq:$PATH
	# ml RHEL6-apps R/3.2.3  #Make sure your R environment is available
	merge-isoseq.sh allIDs.txt run.config &> Results.log

Note: The default output folder is under
	Results/Summary 
unless you provide a different output folder name in your command line as the 3rd parameter.
For instance, "merge-isoseq.sh allIDs.txt run.config Outputs &> Results.log". If so, the
output folder will be
	Outputs/Summary 

Please check Results.log, and see whether this step is successful. If everything is fine, 
you should see a file “RNASeq-merged-metrics.txt” unser the Summary folder.

	
###########################################################
#
## Output files. Most are self-explanatory.
#
###########################################################

sample.annotation.txt			#sample annotation file
RNASeq-lib-size.9x7.png
RNASeq-lib-size.png
reads-split-summary.txt			#reads spitting: rRNA, hgRNA and other
reads-split-summary.9x7.png
reads-split-summary.png
star-mapping-summary.txt		#read mapping summary for STAR run 
star-mapping-summary.9x7.png
star-mapping-summary.png
fc-counting-summary.txt			#read counting summary for featureCounts run
fc-counting-summary.9x7.png
fc-counting-summary.png
RNASeq-snp-corr.txt			#SNP correlation
RNASeq-snp-corr.9x7.png
RNASeq-snp-corr.png
salmon_aln-tx-tpm.txt			#Isoform quantification results: TPMs + Counts
salmon_aln-gene-tpm.txt
salmon_aln-tx-counts.txt
salmon_aln-gene-counts.txt
expr-count-tx.txt			#No of expressed transcripts and genes
expr-count-tx.9x7.png
expr-count-tx.png
expr-count-gene.txt
expr-count-gene.9x7.png
expr-count-gene.png
expr-gene-top10x.9x7.png		#Top 10 highly expressed genes
expr-gene-top10x.details.txt
expr-gene-top10x-noMT.9x7.png
expr-gene-top10x-noMT.png
expr-gene-top10x.png
expr-gene-top10x.txt
expr-gene-top30-across-samples.7x5.png
expr-gene-top30-across-samples.txt
expr-gene-corr.txt			# correlation of gene expressions among samples
expr-gene-corr.9x7.png
expr-gene-corr.png
expr-gene-MADScore.txt			# MADScore for potential outliers
expr-gene-MADScore.9x7.png
expr-gene-MADScore.png
expr-gene-boxplot.9x7.png
expr-gene-boxplot.png
expr-gene-pca.x.txt			#PCA 
expr-gene-pca.var.txt
expr-gene-pca.png
RNASeq-merged-metrics.txt		#Merged QC metrices  !!!
